---
id: 478
title: Подготовка VMM к разворачиванию SQL из шаблона
date: 2014-06-17T11:11:47+00:00
author: rootilo
layout: post
guid: http://4c74356b41.com/post478
permalink: /post478
categories:
  - MIM
  - Virtualization and Cloud
tags:
  - FIM
  - Guide
  - System Center 2012 R2
  - Virtual Machine Manager
---
В продолжение статьи про [установку FIM из шаблона](http://4c74356b41.com/post428), мы рассмотрим подготовку диска с SQL для шаблона сервиса.

**Что произойдет:**
  
1. Установка SQL Server 2012 SP1 Sysprep;
  
2. Настройка VMM

**Что Вам потребуется:**
  
1. Сервер с установленным на него Windows Server 2012 R2 и .NET FX 3.5;
  
2. Дистрибутив SQL Server 2012 SP1;
  
3. VMM 2012 R2

**Установка SQL 2012 SP1 Sysprep**
  
Монтируете образ SQL сервера и запускаете setup. Мои бесчисленные попытки заставить VMM разворачивать SQL шаблон установленный с ISO образа были неудачны. 2 варианта установки: с сетевой шары, с локального диска виртуальной машины. Соответственно окончание установки из шаблона будет требовать тот же самый способ установки. Для sysprep установки необходимо выбрать опцию &#8220;advanced&#8221; и пункт &#8220;Image Preparation of a stand-alone instance of SQL Server&#8221;. Далее Вы проходите плюсминус обычный мастер установки, для того чтобы в дальнейшем все успешно разворачивалось силами VMM Вам необходимо запомнить или записать имя инстанса (я бы рекомендовал даже с учетом регистра). В дальнейшем оно понадобиться для создания шаблона SQL разворачивания в VMM. После успешной установки SQL инстанса Вам необходимо выключить сервер, дальнейшая настройка будет производиться в VMM.

**Настройка профиля SQL в VMM**
  
В консоли VMM в разделе Library необходимо создать SQL Server Profile, в нем создайте SQL Server Deployment. Необходимо заполнить поля Name, Instance Name (MSSQLSERVER) иначе разворачивание не сработает, Instance ID заполнить значением которые Вы указали при разворачивании SQL в предыдущем пункте. Поля &#8220;Product Key&#8221;, &#8220;Runas Account&#8221; и &#8220;Timeout&#8221; опциональны. В закладке Configuration в поле &#8220;Media Source&#8221; необходимо указать путь к дистрибутиву, с которого производилась установка SQL Sysprep. Не забудьте указать администраторов SQL сервера, тип аутентификации и включить TCP/IP. На закладке Service Accounts укажите сервисные аккаунты для сервисов SQL.
  
Так же можно использовать sqlConfig.ini и указать его в поле &#8220;SQL Server configuration file&#8221;.

В целом профиль SQL сервера настраивается интуитивно, главное указать правильное имя инстанса и его ID, и использовать тот же самый дистриюутив для разворачивания SQL из Sysprep. Если Вам нужно что-то &#8220;сложнее&#8221; чем просто SQL, Вам необходимо будет использовать скрипты и настраивать разворачивание непосредственно в самом шаблоне сервиса.