---
id: 1227
title: Self Service –≤–∏—Ä—Ç—É–∞–ª—å–Ω—ã—Ö –º–∞—à–∏–Ω; –°–æ–∑–¥–∞–Ω–∏–µ –≤–∏—Ä—Ç—É–∞–ª—å–Ω–æ–π –º–∞—à–∏–Ω—ã —Å –ø–æ—Ä—Ç–∞–ª–∞ SCSM; (—á–∞—Å—Ç—å 2)
date: 2014-07-09T00:03:17+00:00
author: rootilo
layout: post
guid: http://4c74356b41.com/post1227
permalink: /post1227
categories:
  - Virtualization and Cloud
tags:
  - Guide
  - Operations Manager
  - Orchestrator
  - Private Cloud VM Self Service
  - Service Manager
  - System Center 2012 R2
  - Virtual Machine Manager
---
–í–æ –≤—Ç–æ—Ä–æ–π —á–∞—Å—Ç–∏ –≥–∞–π–¥–∞ –º—ã –æ–±—Ä–∞—Ç–∏–º –≤–∑–æ—Ä—ã –Ω–∞ –¥–æ—á–µ—Ä–Ω–∏–µ runbook'–∏.
  
1. [–°–æ–∑–¥–∞–Ω–∏–µ Runbook'–∞](http://4c74356b41.com/post1176); (—á–∞—Å—Ç—å 1)
  
2.¬†–°–æ–∑–¥–∞–Ω–∏–µ –¥–æ—á–µ—Ä–Ω–∏—Ö Runbook'–æ–≤; (—á–∞—Å—Ç—å 2)
  
3.¬†[–ò–º–ø–æ—Ä—Ç Runbook'–æ–≤ –≤ SCSM](http://4c74356b41.com/post1261);¬†(—á–∞—Å—Ç—å 3)
  
4.¬†[–°–æ–∑–¥–∞–Ω–∏–µ —à–∞–±–ª–æ–Ω–æ–≤ –¥–ª—è –ø—É–±–ª–∏–∫–∞—Ü–∏–∏ –Ω–∞ –ø–æ—Ä—Ç–∞–ª–µ](http://4c74356b41.com/post1261);¬†(—á–∞—Å—Ç—å 3)
  
5.¬†[–ü–æ–¥–≥–æ—Ç–æ–≤–∫–∞ Request Offering –∫ –ø—É–±–ª–∏–∫–∞—Ü–∏–∏](http://4c74356b41.com/post1284);¬†(—á–∞—Å—Ç—å 4)
  
6.¬†[–ü—É–±–ª–∏–∫–∞—Ü–∏—è –∏ –ø—Ä–æ–≤–µ—Ä–∫–∞](http://4c74356b41.com/post1284).¬†(—á–∞—Å—Ç—å 4)

–í–Ω–∞—á–∞–ª–µ —è –ø–æ—è—Å–Ω—é, –∑–∞—á–µ–º –Ω—É–∂–Ω—ã –¥–æ—á–µ—Ä–Ω–∏–µ runbook'–∏. –ò–∑–Ω–∞—á–∞–ª—å–Ω–æ¬†–≤—Å–µ –º–æ–∏ —Ä–∞–Ω–±—É–∫–∏ –∏—Å–ø–æ–ª—å–∑–æ–≤–∞–ª–∏ –ø—Ä–æ—Å—Ç–æ —à–∞–≥ –∑–∞–ø—É—Å–∫ –≤–∏—Ä—Ç—É–∞–ª—å–Ω–æ–π –º–∞—à–∏–Ω—ã –∏–∑ –∏–Ω—Ç–µ–≥—Ä–∞—Ü–∏–æ–Ω–Ω–æ–≥–æ –ø–∞–∫–µ—Ç–∞ VMM, –Ω–æ –ø–æ—Ç–æ–º —è –ø–æ–Ω—è–ª, —á—Ç–æ –¥–∞–Ω–Ω—ã–π —à–∞–≥ –∏—Å–ø–æ–ª—å–∑—É–µ—Ç—Å—è –≤ –ø–æ–ª–æ–≤–∏–Ω–µ runbook'–æ–≤, –∫—Ä–æ–º–µ —Ç–æ–≥–æ, –º–Ω–µ –ø–æ–∫–∞–∑–∞–ª–æ—Å—å, —á—Ç–æ –º–æ–∏ runbook'–∏ "—Ä–∞–∑–¥—É–≤–∞—é—Ç—Å—è"; –¥–æ –Ω–µ–ø—Ä–∏–ª–∏—á–Ω—ã—Ö —Ä–∞–∑–º–µ—Ä–æ–≤, –∏ –∑–∞—Ö–æ—Ç–µ–ª–æ—Å—å –¥–æ–±–∞–≤–∏—Ç—å –≤ –Ω–∏—Ö –º–æ–¥—É–ª—å–Ω–æ—Å—Ç—å, —Ç–∞–∫ –∫–∞–∫¬†–º–æ–¥—É–ª–∏ –ø–æ –æ—Ç–¥–µ–ª—å–Ω–æ—Å—Ç–∏ –ø—Ä–æ—â–µ —Ç–µ—Å—Ç–∏—Ä–æ–≤–∞—Ç—å –∏ –º–æ–∂–Ω–æ –∏—Å–ø–æ–ª—å–∑–æ–≤–∞—Ç—å –∑–∞–Ω–æ–≤–æ (—Å–æ–≤–µ—Ç—É—é –∏—Å–ø–æ–ª—å–∑–æ–≤–∞—Ç—å —Ç–æ—Ç –∂–µ –ø–æ–¥—Ö–æ–¥ –¥–ª—è PowerShell —Å–∫—Ä–∏–ø—Ç–æ–≤ üòâ ).

–ü–æ–¥—Ä–æ–±–Ω–æ–µ –æ–ø–∏—Å–∞–Ω–∏–µ –≤—Å–µ–π —Å–∏—Å—Ç–µ–º—ã —è –≤—ã–ø–∏—à—É –≤ –æ—Ç–¥–µ–ª—å–Ω—ã–π –ø–æ—Å—Ç, –ø–æ—Ç–æ–º—É —Å—Ä–∞–∑—É –∫ –¥–µ–ª—É.
  
–Ø –∏—Å–ø–æ–ª—å–∑—É—é –≤—Å–µ–≥–æ 2 –¥–æ—á–µ—Ä–Ω–∏—Ö runbook'–∞. –≠—Ç–æ –∑–∞–ø—É—Å–∫ –≤–∏—Ä—Ç—É–∞–ª—å–Ω–æ–π –º–∞—à–∏–Ω—ã –∏ –∑–∞–ø—É—Å–∫ —Å–∏–Ω—Ö—Ä–æ–Ω–∏–∑–∞—Ü–∏–∏ –∫–æ–Ω–Ω–µ–∫—Ç–æ—Ä–∞ SCSM.

**–ó–∞–ø—É—Å–∫ –≤–∏—Ä—Ç—É–∞–ª—å–Ω–æ–π –º–∞—à–∏–Ω—ã**
  
Runbook –≤—ã–≥–ª—è–¥–∏—Ç –≤–æ—Ç —Ç–∞–∫
  
<a href="http://4c74356b41.com/wp-content/uploads/2016/02/module-runbooks-00.png" rel="attachment wp-att-5129"><img src="http://4c74356b41.com/wp-content/uploads/2016/02/module-runbooks-00-300x175.png" alt="module-runbooks-00" width="300" height="175" /></a>
  
–ù–∞—á–∏–Ω–∞–µ–º, –∫–∞–∫ –æ–±—ã—á–Ω–æ, —Å —à–∞–≥–∞ Initialize Data.
  
<a href="http://4c74356b41.com/wp-content/uploads/2016/02/module-runbooks-02.png" rel="attachment wp-att-5136"><img src="http://4c74356b41.com/wp-content/uploads/2016/02/module-runbooks-02-300x206.png" alt="module-runbooks-02" width="300" height="206" /></a>
  
Parent Runbook - –±—É–¥–µ—Ç –ø–æ–ª—É—á–∞—Ç—å –∑–Ω–∞—á–µ–Ω–∏–µ {Runbook Process ID from "Initialize Data";} —Ä–æ–¥–∏—Ç–µ–ª—å—Å–∫–æ–≥–æ Runbook'–∞
  
Reserved - –ø–æ–ª—É—á–∏—Ç –∑–Ω–∞—á–µ–Ω–∏–µ "NewVM"; –∏–∑ runbook'–∞ "Create VM from Template";
  
VM ID - –ø–æ–ª—É—á–∏—Ç –∑–Ω–∞—á–µ–Ω–∏–µ {VM ID from "Get VM";}¬†—Ä–æ–¥–∏—Ç–µ–ª—å—Å–∫–æ–≥–æ Runbook'–∞

–î–∞–ª–µ–µ, –∫–∞–∫ –í—ã –∑–∞–º–µ—Ç–∏–ª–∏, runbook –º–æ–∂–µ—Ç "–≤—ã–ø–æ–ª–Ω–∏—Ç—å"; –¥–≤–∞ —Å—Ü–µ–Ω–∞—Ä–∏—è. –î–ª—è –Ω–æ–≤–æ–π –≤–∏—Ä—Ç—É–∞–ª—å–Ω–æ–π –º–∞—à–∏–Ω—ã¬†–∏–ª–∏ –¥–ª—è —Å—É—â–µ—Å—Ç–≤—É—é—â–µ–π. –î–ª—è —ç—Ç–æ–≥–æ –≤ –ª–∏–Ω–∫–µ –∫ —Å–ª–µ–¥—É—é—â–µ–º—É —Å–æ–±—ã—Ç–∏—é –Ω—É–∂–Ω–æ —É–∫–∞–∑–∞—Ç—å —É—Å–ª–æ–≤–∏–µ Reserved¬†from Initialize Data equals "NewVM"; –¥–ª—è —Å—Ü–µ–Ω–∞—Ä–∏—è –∑–∞–ø—É—Å–∫–∞ –Ω–æ–≤–æ–π –≤–∏—Ä—Ç—É–∞–ª—å–Ω–æ–π –º–∞—à–∏–Ω—ã –∏ Reserved from Initialize Data¬†does not equals "NewVM";¬†–¥–ª—è —Å—Ü–µ–Ω–∞—Ä–∏—è –º–æ–¥–∏—Ñ–∏–∫–∞—Ü–∏—è VM.<a href="http://4c74356b41.com/wp-content/uploads/2016/02/module-runbooks-03.png" rel="attachment wp-att-5139"><img src="http://4c74356b41.com/wp-content/uploads/2016/02/module-runbooks-03-300x196.png" alt="module-runbooks-03" width="300" height="196" /></a>

–°–ª–µ–¥—É—é—â–∏–º–∏ —à–∞–≥–∞–º–∏ –±—É–¥–µ—Ç –ø–æ–ª—É—á–∏—Ç—å –¥–∞–Ω–Ω—ã–µ –æ –≤–∏—Ä—Ç—É–∞–ª—å–Ω–æ–π –º–∞—à–∏–Ω–µ –∏ –∑–∞–ø—É—Å—Ç–∏—Ç—å –µ—ë
  
**2. Get VM**
  
Action: Get VM
  
Connector: VMM¬†Connector
  
Filter:¬†{VM ID from "Initialize Data";}

**3. Start VM**
  
Action: Start¬†VM
  
Connector: VMM¬†Connector
  
Filter:¬†{VM ID from "Get VM";}
  
–ò–Ω—Ç–µ—Ä–µ—Å–Ω–∞—è —Ä–µ–º–∞—Ä–∫–∞, –∫–æ–≥–¥–∞ —è –ø—ã—Ç–∞–ª—Å—è —Å–¥–µ–ª–∞—Ç—å —Ç–æ–∂–µ —Å–∞–º–æ–µ –±–µ–∑ —à–∞–≥–∞ "Get VM"; —à–∞–≥ "Start VM"; –≥–µ–Ω–µ—Ä–∏—Ä–æ–≤–∞–ª –æ—à–∏–±–∫—É, —É –º–µ–Ω—è –Ω–µ—Ç –æ–±—ä—è—Å–Ω–µ–Ω–∏—è —ç—Ç–æ–º—É —Ñ–µ–Ω–æ–º–µ–Ω—É, —Ç–∞–∫ –∫–∞–∫¬†–∑–Ω–∞—á–µ–Ω–∏—è —Å–æ–≤–ø–∞–¥–∞—é—Ç.

**4. Delay 90**
  
Action: Run .Net Script
  
Type: PowerShell
  
Script: Sleep 90
  
–ñ–¥–µ–º –ø–æ–∫–∞ –≤–∏—Ä—Ç—É–∞–ª—å–Ω–∞—è –º–∞—à–∏–Ω–∞ –∑–∞–≥—Ä—É–∑–∏—Ç—Å—è –∏ –ø–æ–ª—É—á–∏—Ç¬†IP.

**5. Run VMM PowerShell Script**
  
Action: Run VMM PowerShell Script
  
Connector: VMM Connector
  
PowerShell:¬†$a = Get-SCVirtualMachine {VM Name from "Get VM";} | Get-SCVirtualNetworkAdapter | %{$_.ipv4addresses}
  
Output: $a

**6. Return Data**
  
Action: Return Data (–º–æ–¥—É–ª—å Runbook Control)
  
IP: {Output Variable 01 from "Run VMM PowerShell Script";}
  
–î–ª—è —Ç–æ–≥–æ —á—Ç–æ–±—ã –≤–µ—Ä–Ω—É—Ç—å –¥–∞–Ω–Ω—ã–µ –≤ —Ä–æ–¥–∏—Ç–µ–ª—å—Å–∫–∏–π runbook –Ω—É–∂–Ω–æ –Ω–∞—Å—Ç—Ä–æ–∏—Ç—å —Å–≤–æ–π—Å—Ç–≤–∞ –¥–æ—á–µ—Ä–Ω–µ–≥–æ runbook'–∞ –∏ –¥–æ–±–∞–≤–∏—Ç—å —Ç—É–¥–∞ –ø–µ—Ä–µ–º–µ–Ω–Ω—É—é "IP"; –∏ –ø–æ—Å–ª–µ —ç—Ç–æ–≥–æ —Å–æ–∑–¥–∞—Ç—å –¥–∞–Ω–Ω—ã–π —à–∞–≥.
  
<a href="http://4c74356b41.com/wp-content/uploads/2016/02/module-runbooks-04.png" rel="attachment wp-att-5142"><img src="http://4c74356b41.com/wp-content/uploads/2016/02/module-runbooks-04-300x122.png" alt="module-runbooks-04" width="300" height="122" /></a>
  
<a href="http://4c74356b41.com/wp-content/uploads/2016/02/module-runbooks-05.png" rel="attachment wp-att-5145"><img src="http://4c74356b41.com/wp-content/uploads/2016/02/module-runbooks-05-300x205.png" alt="module-runbooks-05" width="300" height="205" /></a>
  
–ó–Ω–∞—á–µ–Ω–∏–µ –ø–µ—Ä–µ–¥–∞–Ω–Ω–æ–µ –≤ —Ä–æ–¥–∏—Ç–µ–ª—å—Å–∫–∏–π runbook –º–æ–∂–Ω–æ –∏—Å–ø–æ–ª—å–∑–æ–≤–∞—Ç—å –≤ —Ä–æ–¥–∏—Ç–µ–ª—å—Å–∫–æ–º runbook'–µ –≤ –ª—é–±–æ–º —à–∞–≥–µ –ø–æ—Å–ª–µ —à–∞–≥–∞ –∑–∞–ø—É—Å–∫–∞ –¥–æ—á–µ—Ä–Ω–µ–≥–æ runbook'–∞
  
<a href="http://4c74356b41.com/wp-content/uploads/2016/02/module-runbooks-06.png" rel="attachment wp-att-5148"><img src="http://4c74356b41.com/wp-content/uploads/2016/02/module-runbooks-06-300x261.png" alt="module-runbooks-06" width="300" height="261" /></a>
  
–í–æ—Ç —à–∞–≥ Launch VM –∏–∑ —Ä–æ–¥–∏—Ç–µ–ª—å—Å–∫–æ–≥–æ runbook'–∞, —É–∫–∞–∂–∏—Ç–µ –ø–µ—Ä–µ–º–µ–Ω–Ω—ã–µ –∏ runbook¬†(–æ–±—Ä–∞—Ç–∏—Ç–µ –≤–Ω–∏–º–∞–Ω–∏–µ –Ω–∞ –≥–∞–ª–æ—á–∫—É). –î–∞–Ω–Ω—ã–µ –ø–µ—Ä–µ–º–µ–Ω–Ω—ã–µ –±—É–¥—É—Ç –¥–æ—Å—Ç—É–ø–Ω—ã —Ç–æ–ª—å–∫–æ –ø–æ—Å–ª–µ —Ç–æ–≥–æ –∫–∞–∫ –í—ã —Å–æ–∑–¥–∞–¥–∏—Ç–µ —à–∞–≥ Initialize Data –≤ –¥–æ—á–µ—Ä–Ω–µ–º runbook'–µ, —Å–æ–∑–¥–∞–¥–∏—Ç–µ –≤ –Ω–µ–º –ø–µ—Ä–µ–º–µ–Ω–Ω—ã–µ –∏ —Å–æ—Ö—Ä–∞–Ω–∏—Ç–µ –¥–æ—á–µ—Ä–Ω–∏–π¬†runbook.
  
<a href="http://4c74356b41.com/wp-content/uploads/2016/02/module-runbooks-07.png" rel="attachment wp-att-5151"><img src="http://4c74356b41.com/wp-content/uploads/2016/02/module-runbooks-07-300x206.png" alt="module-runbooks-07" width="300" height="206" /></a>

–ï—Å–ª–∏ –í—ã –≤—Å–µ —Å–¥–µ–ª–∞–ª–∏ –ø—Ä–∞–≤–∏–ª—å–Ω–æ, —Ä–æ–¥–∏—Ç–µ–ª—å—Å–∫–∏–π runbook –±—É–¥–µ—Ç –∑–∞–ø—É—Å–∫–∞—Ç—å –¥–æ—á–µ—Ä–Ω–∏–π, –∂–¥–∞—Ç—å –æ–∫–æ–Ω—á–∞–Ω–∏—è runbook'–∞, –ø–æ–ª—É—á–∞—Ç—å –∏–∑ –Ω–µ–≥–æ IP –∞–¥—Ä–µ—Å –≤–∏—Ä—Ç—É–∞–ª—å–Ω–æ–π –º–∞—à–∏–Ω—ã –∏ –æ–±–Ω–æ–≤–ª—è—Ç—å Service Request –Ω–∞ –ø–æ—Ä—Ç–∞–ª–µ —ç—Ç–∏–º–∏ –¥–∞–Ω–Ω—ã–º–∏.

**–ó–∞–ø—É—Å–∫ —Å–∏–Ω—Ö—Ä–æ–Ω–∏–∑–∞—Ü–∏–∏ –∫–æ–Ω–Ω–µ–∫—Ç–æ—Ä–∞ SCSM-SCOM**
  
Runbook —Å–æ—Å—Ç–æ–∏—Ç –∏–∑ 1 –¥–µ–π—Å—Ç–≤–∏—è "Run Program";, –¥–ª—è —Ç–æ–≥–æ, —á—Ç–æ–±—ã —ç—Ç–æ —Ä–∞–±–æ—Ç–∞–ª–æ, –Ω–µ–æ–±—Ö–æ–¥–∏–º Service Manager Shell –Ω–∞ —Å–µ—Ä–≤–µ—Ä–µ Orchestrator
  
cmd.exe /c | C:\Windows\system32\WindowsPowerShell\v1.0\powershell.exe ‚Äìc ¬†c:Start-SCOM-Sync.ps1
  
–°–æ–¥–µ—Ä–∂–∏–º–æ–µ —Å–∫—Ä–∏–ø—Ç–∞ (—Å–∫—Ä–∏–ø—Ç –¥–æ–ª–∂–µ–Ω —Å–∞–º —Å–µ–±—è "—É–±–∏–≤–∞—Ç—å";)
  
Get-SCSMConnector -ComputerName lab-scsm-01 | where {$\_.displayname -Match "–∏–º—è\_–∫–æ–Ω–Ω–µ–∫—Ç–æ—Ä–∞_scom";} | Start-SCSMConnector
  
$objCurrentPSProcess = [System.Diagnostics.Process]::GetCurrentProcess();
  
Stop-Process -Id $objCurrentPSProcess.ID;
  
<a href="http://4c74356b41.com/wp-content/uploads/2016/02/module-runbooks-08.png" rel="attachment wp-att-5154"><img src="http://4c74356b41.com/wp-content/uploads/2016/02/module-runbooks-08-300x206.png" alt="module-runbooks-08" width="300" height="206" /></a>
  
–¢—É—Ç –Ω–µ–æ–±—Ö–æ–¥–∏–º–æ –ø–æ—è—Å–Ω–∏—Ç—å:¬†—è —Å–æ–∑–¥–∞–ª –¥–∞–Ω–Ω—ã–π¬†runbook,¬†—Ç–∞–∫ –∫–∞–∫ —Ö–æ—Ç–µ–ª, —á—Ç–æ–±—ã –≤ —Ç–µ—Å—Ç–æ–≤–æ–π —Å—Ä–µ–¥–µ –∏–∑–º–µ–Ω–µ–Ω–∏—è –æ—Ç–æ–±—Ä–∞–∂–∞–ª–∏—Å—å —Å—Ä–∞–∑—É –ø–æ—Å–ª–µ —Å–æ–∑–¥–∞–Ω–∏—è,¬†–∏–∑–º–µ–Ω–µ–Ω–∏—è –∏–ª–∏ —É–¥–∞–ª–µ–Ω–∏—è¬†–≤–∏—Ä—Ç—É–∞–ª—å–Ω–æ–π –º–∞—à–∏–Ω—ã.¬†–í¬†"–±–æ–µ–≤–æ–π"; —Å—Ä–µ–¥–µ —è –±—ã –Ω–µ —Ä–µ–∫–æ–º–µ–Ω–¥–æ–≤–∞–ª –∑–∞–ø—É—Å–∫–∞—Ç—å —Å–∏–Ω—Ö—Ä–æ–Ω–∏–∑–∞—Ü–∏—é –ø–æ—Å–ª–µ –∫–∞–∂–¥–æ–≥–æ –∑–∞–ø—Ä–æ—Å–∞ –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è, —Ç–∞–∫ –∫–∞–∫ —ç—Ç–æ –æ—á–µ–Ω—å —Ä–µ—Å—É—Ä—Å–æ–µ–º–∫–∞—è –æ–ø–µ—Ä–∞—Ü–∏—è.
  
–í–µ—Ä–æ—è—Ç–Ω–æ, –µ—Å—Ç—å –≤–∞—Ä–∏–∞–Ω—Ç—ã –∑–∞–ø–æ–ª–Ω—è—Ç—å CMDB "—Ç–æ—á–µ—á–Ω–æ";, —Ç.–µ. –±—Ä–∞—Ç—å —Å—É—â–Ω–æ—Å—Ç—å –∏–∑ VMM –∏–ª–∏ SCOM –∏ –Ω–∞–ø—Ä—è–º—É—é –ø–µ—Ä–µ–¥–∞–≤–∞—Ç—å –≤ CMDB.¬†–≠—Ç–æ—Ç –≤–∞—Ä–∏–∞–Ω—Ç –±—ã–ª –±—ã –∏–¥–µ–∞–ª–µ–Ω, –Ω–æ –ø–æ —ç—Ç–æ–º—É –≤–æ–ø—Ä–æ—Å—É¬†—è –í–∞–º –Ω–∏—á–µ–≥–æ –ø–æ–≤–µ–¥–∞—Ç—å –Ω–µ –º–æ–≥—É, –ø–æ –∫—Ä–∞–π–Ω–µ–π –º–µ—Ä–µ –ø–æ–∫–∞.